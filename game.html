<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Fun Challenge!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            /* New cosmos background image */
            background-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=2071&auto.format&fit=crop');
            background-size: cover;
            background-position: center;
            background-color: #0b021f;
            position: relative;
            z-index: 0;
        }

        /* Animated gradient overlay for a more dynamic cosmos */
        body::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #1d2b64, #f8cdda, #4a1d42, #0f1c3d);
            background-size: 400% 400%;
            animation: gradient-animation 20s ease infinite;
            opacity: 0.8;
            z-index: -1;
        }

        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #character-image {
            transition: transform 0.3s ease-in-out, filter 0.3s ease-in-out;
            object-fit: cover;
        }
        
        /* Glow effects for different moods */
        .happy-glow {
            filter: drop-shadow(0 0 20px rgba(255, 105, 180, 0.7)); /* Pink */
        }
        .ecstatic-glow {
            animation: rainbow-glow 2s linear infinite;
        }

        @keyframes rainbow-glow {
            0% { filter: drop-shadow(0 0 35px rgba(255, 0, 0, 1)); }
            15% { filter: drop-shadow(0 0 35px rgba(255, 165, 0, 1)); }
            30% { filter: drop-shadow(0 0 35px rgba(255, 255, 0, 1)); }
            45% { filter: drop-shadow(0 0 35px rgba(0, 255, 0, 1)); }
            60% { filter: drop-shadow(0 0 35px rgba(0, 127, 255, 1)); }
            75% { filter: drop-shadow(0 0 35px rgba(75, 0, 130, 1)); }
            90% { filter: drop-shadow(0 0 35px rgba(238, 130, 238, 1)); }
            100% { filter: drop-shadow(0 0 35px rgba(255, 0, 0, 1)); }
        }
        
        #give-chocolate-btn {
             transition: transform 0.1s ease;
        }
        #give-chocolate-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="antialiased text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md mb-6">
        <div id="progress-container" class="w-full bg-gray-900/60 rounded-full h-5 relative border-2 border-gray-500 backdrop-blur-sm">
            <div id="progress-bar" class="bg-gradient-to-r from-pink-500 to-yellow-400 h-full rounded-full transition-all duration-200 ease-linear" style="width: 0%;"></div>
        </div>
        <div class="relative w-full max-w-md mt-1">
             <div class="absolute text-lg" style="left: 5%; transform: translateX(-50%);">üòê</div>
             <div class="absolute text-lg" style="left: 50%; transform: translateX(-50%);">üòä</div>
             <div class="absolute text-lg" style="right: 0; transform: translateX(50%);">üòç</div>
        </div>
    </div>

    <h1 class="text-5xl font-bold mt-8 mb-6" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.4);">Feed Nits</h1>
    <img id="character-image" src="https://iili.io/KT3OVLJ.md.jpg" class="mx-auto rounded-2xl shadow-lg w-[300px] h-[300px]" alt="Character waiting for a chocolate">
    
    <div class="hidden md:flex flex-col items-center gap-4 absolute top-1/2 -translate-y-1/2 left-8">
        <div class="text-2xl font-semibold" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">
            Brownies: <span id="chocolate-count" class="font-bold text-yellow-400">0</span>
        </div>
        <img id="give-chocolate-btn" src="https://iili.io/KIbUA3F.md.png" class="w-32 cursor-pointer transition-transform duration-150 ease-in-out hover:scale-110 active:scale-95" alt="Give a chocolate" title="Click me or press Spacebar!">
    </div>

    <p class="hidden md:block absolute top-1/2 -translate-y-1/2 right-8 text-base text-gray-200" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">(Hold Spacebar or Click)</p>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let chocolateCount = 0;
            let currentMood = 'waiting';
            let synth;
            let isAudioReady = false;

            // --- MODIFIED: Variables for spacebar hold functionality ---
            let spaceHeldInterval = null;
            let spaceHeldTimeout = null;
            let isSpaceHeldDown = false;

            const CONTENT_THRESHOLD = 1;
            const HAPPY_THRESHOLD = 10;
            const ECSTATIC_THRESHOLD = 20;

            const characterImage = document.getElementById('character-image');
            const giveChocolateBtn = document.getElementById('give-chocolate-btn');
            const chocolateCountDisplay = document.getElementById('chocolate-count');
            const progressBar = document.getElementById('progress-bar');

            const waitingImage = 'nithawp.jpg';
            const contentImage = 'n2.png';
            const happyImage = '45.png';
            const ecstaticImage = 'n4.png';
            
            function getMoodLevel(mood) {
                if (mood === 'ecstatic') return 3;
                if (mood === 'happy') return 2;
                if (mood === 'content') return 1;
                return 0;
            }

            async function giveChocolate() {
                if (!isAudioReady) {
                    await Tone.start();
                    synth = new Tone.Synth().toDestination();
                    isAudioReady = true;
                }
                if (isAudioReady) {
                    synth.triggerAttackRelease("C7", "16n");
                }
                // Visual effect for the button
                if (giveChocolateBtn) {
                    giveChocolateBtn.style.transform = 'scale(0.9)';
                    setTimeout(() => { giveChocolateBtn.style.transform = 'scale(1)'; }, 100);
                }
                chocolateCount++;
                updateGame();
            }

            if (giveChocolateBtn) {
                giveChocolateBtn.addEventListener('click', giveChocolate);
            }

            // --- MODIFIED: Keydown event for tap and hold ---
            document.addEventListener('keydown', (event) => {
                if (event.code === 'Space' && !isSpaceHeldDown) {
                    event.preventDefault();
                    isSpaceHeldDown = true;

                    // Give one brownie immediately for the "tap"
                    giveChocolate();

                    // After a short delay, start adding brownies continuously for the "hold"
                    spaceHeldTimeout = setTimeout(() => {
                        spaceHeldInterval = setInterval(giveChocolate, 100); // Adjust speed here
                    }, 200); // Adjust delay before hold kicks in
                }
            });

            // --- MODIFIED: Keyup event to stop the hold ---
            document.addEventListener('keyup', (event) => {
                if (event.code === 'Space') {
                    event.preventDefault();
                    // Clear the timeout and interval to stop adding brownies
                    clearTimeout(spaceHeldTimeout);
                    clearInterval(spaceHeldInterval);
                    isSpaceHeldDown = false;
                }
            });

            function updateGame() {
                if (chocolateCountDisplay) {
                    chocolateCountDisplay.textContent = chocolateCount;
                }
                
                const progressPercent = Math.min((chocolateCount / ECSTATIC_THRESHOLD) * 100, 100);
                progressBar.style.width = `${progressPercent}%`;

                let newImage = waitingImage;
                let newGlow = '';
                let newMood = 'waiting';

                if (chocolateCount >= ECSTATIC_THRESHOLD) {
                    newMood = 'ecstatic'; newImage = ecstaticImage; newGlow = 'ecstatic-glow';
                } else if (chocolateCount >= HAPPY_THRESHOLD) {
                    newMood = 'happy'; newImage = happyImage; newGlow = 'happy-glow';
                } else if (chocolateCount >= CONTENT_THRESHOLD) {
                    newMood = 'content'; newImage = contentImage; newGlow = ''; 
                } else {
                    newMood = 'waiting'; newImage = waitingImage; newGlow = ''; 
                }

                if (newMood !== currentMood && isAudioReady) {
                    const oldLevel = getMoodLevel(currentMood);
                    const newLevel = getMoodLevel(newMood);
                    const now = Tone.now();

                    if (newLevel > oldLevel) {
                        if (newMood === 'content') synth.triggerAttackRelease("C5", "8n", now);
                        else if (newMood === 'happy') { synth.triggerAttackRelease("E5", "8n", now); synth.triggerAttackRelease("G5", "8n", now + 0.1); }
                        else if (newMood === 'ecstatic') { synth.triggerAttackRelease("C6", "8n", now); synth.triggerAttackRelease("E6", "8n", now + 0.1); synth.triggerAttackRelease("G6", "8n", now + 0.2); }
                    } else if (newLevel < oldLevel) {
                        if (newMood === 'happy') { synth.triggerAttackRelease("B4", "8n", now); synth.triggerAttackRelease("G4", "8n", now + 0.1); }
                        else if (newMood === 'content') { synth.triggerAttackRelease("A4", "8n", now); synth.triggerAttackRelease("F4", "8n", now + 0.1); }
                        else if (newMood === 'waiting') { synth.triggerAttackRelease("C4", "8n", now); synth.triggerAttackRelease("A3", "4n", now + 0.15); }
                    }
                }
                currentMood = newMood;

                if (characterImage.src !== newImage) {
                    characterImage.src = newImage;
                }
                
                characterImage.className = 'mx-auto rounded-2xl shadow-lg w-[300px] h-[300px]';
                if (newGlow) {
                    characterImage.classList.add(newGlow);
                }
            }

            setInterval(() => {
                if (chocolateCount > 0) {
                    chocolateCount--;
                    updateGame();
                }
            }, 400);

            updateGame();
        });
    </script>

</body>

</html>



